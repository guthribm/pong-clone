import{r as i,e as we,j as o,B as y}from"./index-C6O1qL8T.js";import{u as ve,d as oe,A as Re,T as Se,I as be,e as je,f as w,g as X,h as Pe,P as Me}from"./PlayArrow-DaUY_vPx.js";import{S as ke,C as Ce}from"./Stack-ICdrLBtF.js";import{S as Ae,M as Y}from"./Select-Cq4daqs-.js";const v=10,b=20,C={I:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]],O:[[[2,2],[2,2]]],T:[[[0,3,0],[3,3,3],[0,0,0]],[[0,3,0],[0,3,3],[0,3,0]],[[0,0,0],[3,3,3],[0,3,0]],[[0,3,0],[3,3,0],[0,3,0]]],L:[[[0,0,4],[4,4,4],[0,0,0]],[[0,4,0],[0,4,0],[0,4,4]],[[0,0,0],[4,4,4],[4,0,0]],[[4,4,0],[0,4,0],[0,4,0]]],J:[[[5,0,0],[5,5,5],[0,0,0]],[[0,5,5],[0,5,0],[0,5,0]],[[0,0,0],[5,5,5],[0,0,5]],[[0,5,0],[0,5,0],[5,5,0]]],S:[[[0,6,6],[6,6,0],[0,0,0]],[[0,6,0],[0,6,6],[0,0,6]]],Z:[[[7,7,0],[0,7,7],[0,0,0]],[[0,0,7],[0,7,7],[0,7,0]]]},J=["#000000","#00ffff","#0000ff","#ff8000","#ffff00","#00ff00","#ff0000","#8000ff"];function ie(){return Array.from({length:b},()=>Array.from({length:v},()=>0))}function ze(d){const x=d.length,j=Array.from({length:x},()=>Array.from({length:x},()=>0));for(let p=0;p<x;p++)for(let R=0;R<x;R++)j[R][x-1-p]=d[p][R];return j}function W(){const d=Object.keys(C);for(let x=d.length-1;x>0;x--){const j=Math.floor(Math.random()*(x+1));[d[x],d[j]]=[d[j],d[x]]}return d}function Le(){const d=i.useRef(null),x=i.useRef(null),j=i.useRef(null),p=i.useRef(null),R=i.useRef(null),le=ve(),E=oe(le.breakpoints.down("sm")),ce=oe("(orientation: landscape)"),[k,Q]=i.useState(!1),[O,F]=i.useState(!1),[ae,U]=i.useState(0),[N,Z]=i.useState(1),[V,_]=i.useState(0),[ee,fe]=i.useState("Normal"),L=i.useRef(ie()),P=i.useRef(W()),A=i.useRef([]),G=i.useRef(null),$=i.useRef(!0),S=i.useRef(null),H=i.useRef([]),ue=we();function B(){if(A.current.length<3){for(;P.current.length===0;)P.current=W();A.current.push(...P.current.splice(0,3))}const e=A.current.shift(),n=C[e][0].map(s=>s.slice());S.current={shape:n,x:Math.floor((v-n[0].length)/2),y:-n.length+1,id:e},$.current=!0}function he(){const e=d.current,n=(j.current??e.parentElement).getBoundingClientRect(),s=Math.max(1,window.devicePixelRatio||1);let r;E?ce?r=Math.min(n.width,n.height*.8,window.innerHeight*.6):r=Math.min(n.width*.9,n.height*.7,window.innerWidth*.85):r=Math.floor(Math.min(n.width,n.height)),e.style.width=`${r}px`,e.style.height=`${Math.floor(r*(b/v))}px`,e.width=Math.max(1,Math.floor(r*s)),e.height=Math.max(1,Math.floor(r*(b/v)*s)),e.getContext("2d").setTransform(s,0,0,s,0,0),se()}i.useEffect(()=>{function e(){he()}return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),i.useEffect(()=>{if(!O){p.current&&cancelAnimationFrame(p.current),p.current=null,R.current=null;return}function e(t){R.current||(R.current=t);const n=Math.min(.05,(t-R.current)/1e3);R.current=t,xe(n),se(),p.current=requestAnimationFrame(e)}return p.current=requestAnimationFrame(e),()=>{p.current&&cancelAnimationFrame(p.current),p.current=null}},[O]);const q=i.useRef(0);function xe(e){q.current+=e;const t=Math.max(.06,.5-(N-1)*.04-(ee==="Hard"?.12:0));q.current>t&&(q.current=0,ne());const n=H.current;for(let s=n.length-1;s>=0;s--){const r=n[s];r.life-=e*2,r.x+=r.vx*e,r.y+=r.vy*e,r.vy+=300*e,r.life<=0&&n.splice(s,1)}n.length>30&&n.splice(0,n.length-30)}function te(){const e=S.current;if(!e)return;const t=L.current;for(let s=0;s<e.shape.length;s++)for(let r=0;r<e.shape[s].length;r++)if(e.shape[s][r]){const l=e.x+r,g=e.y+s;g>=0&&g<b&&l>=0&&l<v&&(t[g][l]=e.shape[s][r])}let n=0;for(let s=b-1;s>=0;s--)t[s].every(r=>r>0)&&(t.splice(s,1),t.unshift(Array.from({length:v},()=>0)),n++,s++);if(n>0){U(r=>r+n*n*100),_(r=>r+n);const s=Math.min(n*6,20);for(let r=0;r<s;r++)H.current.push({x:Math.random()*v,y:Math.random()*b/3,life:.4+Math.random()*.4,vx:(Math.random()-.5)*60,vy:-60+Math.random()*30});V+n>=N*10&&Z(r=>r+1)}B()}function ne(){const e=S.current;if(!e){B();return}e.y+=1,D(e)&&(e.y-=1,te())}function D(e){const t=L.current;for(let n=0;n<e.shape.length;n++)for(let s=0;s<e.shape[n].length;s++){if(!e.shape[n][s])continue;const r=e.x+s,l=e.y+n;if(r<0||r>=v||l>=b||l>=0&&t[l][r]>0)return!0}return!1}function re(e){const t=S.current;t&&(t.x+=e,D(t)&&(t.x-=e))}function me(){const e=S.current;if(!e)return;const t=ze(e.shape),n=e.shape;e.shape=t,D(e)&&(e.shape=n)}function de(){const e=S.current;if(e){for(;!D(e);)e.y+=1;e.y-=1,te()}}function pe(){if(!$.current)return;const e=S.current;if(!e)return;const t=G.current;G.current=e.id,t?S.current={shape:C[t][0].map(n=>n.slice()),x:Math.floor((v-C[t][0][0].length)/2),y:-C[t][0].length+1,id:t}:B(),$.current=!1}function se(){const e=d.current,t=e.getContext("2d"),n=e.width/Math.max(1,window.devicePixelRatio||1),s=e.height/Math.max(1,window.devicePixelRatio||1);t.fillStyle="#000000",t.fillRect(0,0,n,s),t.strokeStyle="#00ff00",t.lineWidth=2,t.strokeRect(1,1,n-2,s-2);const r=(n-4)/v,l=(s-4)/b,g=2,M=2,z=L.current;for(let f=0;f<b;f++)for(let m=0;m<v;m++){const u=z[f][m];if(u){const a=g+m*r,h=M+f*l;t.fillStyle=J[u],t.fillRect(a+1,h+1,r-2,l-2),t.fillStyle="rgba(255,255,255,0.3)",t.fillRect(a+1,h+1,r-2,3),t.fillRect(a+1,h+1,3,l-2),t.fillStyle="rgba(0,0,0,0.3)",t.fillRect(a+r-4,h+1,3,l-2),t.fillRect(a+1,h+l-4,r-2,3)}}const c=S.current;if(c){for(let f=0;f<c.shape.length;f++)for(let m=0;m<c.shape[f].length;m++)if(c.shape[f][m]){const u=g+(c.x+m)*r,a=M+(c.y+f)*l,h=c.shape[f][m];t.fillStyle=J[h],t.fillRect(u+1,a+1,r-2,l-2),t.fillStyle="rgba(255,255,255,0.4)",t.fillRect(u+1,a+1,r-2,3),t.fillRect(u+1,a+1,3,l-2),t.fillStyle="rgba(0,0,0,0.4)",t.fillRect(u+r-4,a+1,3,l-2),t.fillRect(u+1,a+l-4,r-2,3)}}t.save(),t.globalCompositeOperation="lighter";for(const f of H.current){const m=g+f.x*r,u=M+f.y*l,a=Math.max(0,f.life),h=4*a;t.fillStyle=`rgba(255,255,0,${a})`,t.fillRect(m-h,u-h,h*2,h*2)}t.restore(),t.save(),t.fillStyle="#00ff00",t.font="bold 16px 'Press Start 2P', monospace",t.textAlign="center",t.shadowBlur=6,t.shadowColor="#00ff00",t.fillText("TETRIS",n/2,20),t.restore(),ge()}function ge(){const e=x.current;if(!e)return;const t=Math.max(1,window.devicePixelRatio||1),n=96;e.style.width=`${n}px`,e.style.height=`${n}px`,e.width=n*t,e.height=n*t;const s=e.getContext("2d");s.setTransform(t,0,0,t,0,0),s.fillStyle="#000000",s.fillRect(0,0,n,n),s.strokeStyle="#00ff00",s.lineWidth=1,s.strokeRect(2,2,n-4,n-4);let r=A.current[0];if(r||(P.current.length===0&&(P.current=W()),r=P.current[0]),!r)return;const g=C[r][0],M=g.length,z=g[0].length,c=Math.floor((n-8)/Math.max(z,M,4)),f=Math.floor((n-z*c)/2),m=Math.floor((n-M*c)/2);for(let u=0;u<M;u++)for(let a=0;a<z;a++){const h=g[u][a];if(!h)continue;const T=f+a*c,I=m+u*c;s.fillStyle=J[h],s.fillRect(T,I,c-1,c-1),s.fillStyle="rgba(255,255,255,0.3)",s.fillRect(T,I,c-1,1),s.fillRect(T,I,1,c-1),s.fillStyle="rgba(0,0,0,0.3)",s.fillRect(T+c-2,I,1,c-1),s.fillRect(T,I+c-2,c-1,1)}}function K(){Q(!0),F(!0),B()}function ye(){L.current=ie(),P.current=W(),A.current=[],G.current=null,U(0),Z(1),_(0),Q(!1),F(!1),H.current=[]}return i.useEffect(()=>{function e(t){k&&(t.key==="ArrowLeft"?re(-1):t.key==="ArrowRight"?re(1):t.key==="ArrowUp"?me():t.key===" "?de():t.key==="ArrowDown"?ne():t.key.toLowerCase()==="c"?pe():t.key==="p"&&F(n=>!n))}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)}),o.jsxs(y,{sx:{minHeight:"100vh",height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[o.jsx(Re,{position:"static",color:"transparent",elevation:0,sx:{borderBottom:"1px solid rgba(255,255,255,0.06)"},children:o.jsxs(Se,{sx:{minHeight:{xs:48,sm:64}},children:[o.jsx(be,{edge:"start",color:"inherit",onClick:()=>ue("/"),children:o.jsx(je,{})}),o.jsx(w,{variant:"h6",sx:{flex:1,fontSize:{xs:14,sm:20}},children:"Tetris"}),o.jsxs(ke,{direction:"row",spacing:1,alignItems:"center",children:[o.jsxs(Ae,{value:ee,size:"small",onChange:e=>fe(e.target.value),sx:{minWidth:{xs:80,sm:120}},children:[o.jsx(Y,{value:"Easy",children:"Easy"}),o.jsx(Y,{value:"Normal",children:"Normal"}),o.jsx(Y,{value:"Hard",children:"Hard"})]}),k&&o.jsx(X,{variant:"outlined",size:E?"small":"medium",onClick:()=>F(e=>!e),children:O?"Pause":"Play"}),o.jsx(X,{variant:"contained",size:E?"small":"medium",onClick:ye,children:"Restart"})]})]})}),o.jsx(Ce,{maxWidth:"lg",sx:{py:{xs:1,sm:2},px:{xs:1,sm:2},flex:1,display:"flex",alignItems:"stretch"},children:o.jsxs(Pe,{sx:{p:{xs:1,sm:2},width:"100%",height:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box",position:"relative"},children:[!k&&o.jsxs(y,{onClick:K,sx:{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"rgba(0, 0, 0, 0.9)",zIndex:10,color:"#00ff00",textAlign:"center",cursor:"pointer"},children:[o.jsx(w,{variant:"h4",sx:{mb:3,fontSize:{xs:"1.5rem",sm:"2rem"},fontFamily:"'Press Start 2P', monospace",textShadow:"0 0 10px #00ff00"},children:"TETRIS"}),o.jsxs(w,{variant:"body1",sx:{mb:4,fontSize:{xs:"0.6rem",sm:"0.8rem"},fontFamily:"'Press Start 2P', monospace",color:"#ffffff",maxWidth:"80%",lineHeight:1.6},children:["Arrange falling blocks to clear lines!",o.jsx("br",{}),"Tap anywhere on the game area to start!"]}),o.jsx(X,{variant:"contained",size:"large",startIcon:o.jsx(Me,{}),onClick:K,sx:{fontSize:{xs:"0.7rem",sm:"0.9rem"},padding:{xs:"8px 16px",sm:"12px 24px"},fontFamily:"'Press Start 2P', monospace",background:"linear-gradient(45deg, #00ff00, #00aa00)",boxShadow:"0 0 20px rgba(0, 255, 0, 0.5)"},children:"START GAME"}),o.jsx(w,{variant:"caption",sx:{mt:3,fontSize:{xs:"0.4rem",sm:"0.5rem"},color:"#888",fontFamily:"'Press Start 2P', monospace",textAlign:"center"},children:E?"Tap buttons below to control pieces":"Controls: ← → ↑ ↓ Arrow Keys | Space: Hard Drop | C: Hold | P: Pause"})]}),o.jsx(y,{ref:j,sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:o.jsx("canvas",{ref:d,onClick:()=>!k&&K(),style:{touchAction:"none",maxWidth:"100%",height:"100%",display:"block",cursor:k?"default":"pointer"}})}),k&&o.jsxs(y,{sx:{mt:{xs:1,sm:1},display:"flex",flexDirection:{xs:"column",sm:"row"},gap:{xs:1,sm:1},justifyContent:"space-between",alignItems:"center",height:{xs:"auto",sm:110},background:"rgba(0, 0, 0, 0.8)",p:{xs:1,sm:2},borderRadius:1,border:"1px solid #00ff00"},children:[o.jsxs(y,{sx:{display:"flex",gap:{xs:3,sm:4},justifyContent:"space-around",width:{xs:"100%",sm:"auto"}},children:[o.jsxs(y,{sx:{textAlign:"center"},children:[o.jsx(w,{variant:"subtitle2",sx:{fontSize:{xs:"0.6rem",sm:"0.875rem"},color:"#00ff00",fontFamily:"'Press Start 2P', monospace"},children:"Score"}),o.jsx(w,{variant:"h6",sx:{fontSize:{xs:"0.7rem",sm:"1.25rem"},color:"#ffffff",fontFamily:"'Press Start 2P', monospace"},children:ae})]}),o.jsxs(y,{sx:{textAlign:"center"},children:[o.jsx(w,{variant:"subtitle2",sx:{fontSize:{xs:"0.6rem",sm:"0.875rem"},color:"#00ff00",fontFamily:"'Press Start 2P', monospace"},children:"Level"}),o.jsx(w,{variant:"h6",sx:{fontSize:{xs:"0.7rem",sm:"1.25rem"},color:"#ffffff",fontFamily:"'Press Start 2P', monospace"},children:N})]}),o.jsxs(y,{sx:{textAlign:"center"},children:[o.jsx(w,{variant:"subtitle2",sx:{fontSize:{xs:"0.6rem",sm:"0.875rem"},color:"#00ff00",fontFamily:"'Press Start 2P', monospace"},children:"Lines"}),o.jsx(w,{variant:"h6",sx:{fontSize:{xs:"0.7rem",sm:"1.25rem"},color:"#ffffff",fontFamily:"'Press Start 2P', monospace"},children:V})]})]}),o.jsx(y,{sx:{display:"flex",alignItems:"center",justifyContent:{xs:"center",sm:"flex-end"},mt:{xs:1,sm:0}},children:o.jsxs(y,{sx:{mr:{xs:0,sm:1},width:{xs:80,sm:96},display:"flex",flexDirection:"column",alignItems:"center",bgcolor:"rgba(255,255,255,0.02)",borderRadius:1,p:.5,border:"1px solid rgba(255,255,255,0.06)"},children:[o.jsx(w,{variant:"subtitle2",sx:{fontSize:{xs:10,sm:12},color:"#00ff00",fontFamily:"'Press Start 2P', monospace"},children:"Next"}),o.jsx(y,{sx:{width:{xs:80,sm:96},height:{xs:80,sm:96},display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx("canvas",{ref:x,style:{width:"100%",height:"100%",display:"block",borderRadius:6}})})]})})]})]})})]})}export{Le as default};
