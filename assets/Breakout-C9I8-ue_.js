import{r as h,h as ae,j as x,B as X}from"./index-B4AHr6Z4.js";import{A as ce,T as le,I as se,h as ue,j as fe,S as he,M as F,P as xe}from"./ArrowBack-mw4x3yPs.js";import{r as C,b as _,c as q}from"./game-BcpCW_1z.js";import{S as de,B as J,C as pe}from"./Stack-CGl372gr.js";const ye=16/9;function ge(){const M=h.useRef(null),v=h.useRef(null),g=h.useRef(null),[S,P]=h.useState(!1),[A,Q]=h.useState("Normal"),[Y,$]=h.useState(0),[I,E]=h.useState(3),j=h.useRef([]),d=h.useRef({x:0,y:0,vx:0,vy:0,r:8}),l=h.useRef({x:0,y:0,w:120,h:16,speed:800}),L=h.useRef([]),z=h.useRef([]),B=h.useRef([]),p=h.useRef({}),[D,G]=h.useState(1),w=h.useRef([]),Z=ae();function W(){const n=M.current,r=n.parentElement.getBoundingClientRect(),a=Math.max(1,window.devicePixelRatio||1),f=Math.floor(r.width),c=Math.floor(r.width/ye);n.style.width=`${f}px`,n.style.height=`${c}px`,n.width=Math.floor(f*a),n.height=Math.floor(c*a),n.getContext("2d").setTransform(a,0,0,a,0,0)}function O(n,e=1){const f=Math.min(8,3+e),c=8,i=(n-c*11)/10,o=Math.max(18,22-Math.floor(e/2)),t=[];for(let s=0;s<f;s++)for(let y=0;y<10;y++){const m=Math.random();let u="normal",b=1;m<.08+e*.01?(u="unbreakable",b=-1):m<.2+e*.02&&(u="strong",b=2),t.push({x:c+y*(i+c),y:c+s*(o+c)+20,w:i,h:o,hits:b,alive:!0,type:u})}j.current=t}function T(n,e){l.current.w=Math.max(72,Math.min(220,n*.14)),l.current.h=Math.max(12,e*.03),l.current.x=(n-l.current.w)/2,l.current.y=e-l.current.h-12,d.current.r=Math.max(6,Math.min(14,n*.008)),C(d.current,n,e,null),$(0),E(3),z.current=[],L.current=[],B.current=[],p.current={},G(1);const r={x:0,y:0,vx:0,vy:0,r:Math.max(6,Math.min(14,n*.008))};C(r,n,e,null),w.current=[r],A==="Easy"&&U(r,2),O(n,1)}h.useEffect(()=>{const n=M.current;function e(){W();const r=n.width/Math.max(1,window.devicePixelRatio||1),a=n.height/Math.max(1,window.devicePixelRatio||1);T(r,a),H()}return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),h.useEffect(()=>{if(!S){v.current&&(cancelAnimationFrame(v.current),v.current=null,g.current=null);return}function n(e){g.current||(g.current=e);const r=Math.min(.05,(e-g.current)/1e3);g.current=e,ne(r),H(),v.current=requestAnimationFrame(n)}return v.current=requestAnimationFrame(n),()=>{v.current&&cancelAnimationFrame(v.current),v.current=null,g.current=null}},[S,A]);function k(n,e,r=12){const a=L.current;for(let f=0;f<r;f++)a.push({x:n,y:e,vx:(Math.random()-.5)*240,vy:(Math.random()-.5)*240-60,life:.6+Math.random()*.8})}function U(n,e=2){const r=w.current;for(let a=0;a<e;a++){const f=Math.random()*Math.PI-Math.PI/2,c=Math.sqrt(n.vx*n.vx+n.vy*n.vy)||320,i={x:n.x+(Math.random()-.5)*12,y:n.y+(Math.random()-.5)*12,vx:Math.cos(f)*c*(.8+Math.random()*.6),vy:Math.sin(f)*c*(.8+Math.random()*.6),r:n.r};r.push(i)}}function ee(n){const e=L.current;for(let r=e.length-1;r>=0;r--)e[r].life-=n,e[r].x+=e[r].vx*n,e[r].y+=e[r].vy*n,e[r].vy+=600*n,e[r].life<=0&&e.splice(r,1)}function te(n){const e=z.current;for(const r of w.current)e.unshift({x:r.x,y:r.y,life:.45});for(let r=e.length-1;r>=0;r--)e[r].life-=n,e[r].life<=0&&e.splice(r,1)}function ne(n){const e=M.current,r=e.width/Math.max(1,window.devicePixelRatio||1),a=e.height/Math.max(1,window.devicePixelRatio||1),f=w.current;for(let o=f.length-1;o>=0;o--){const t=f[o];t.x+=t.vx*n,t.y+=t.vy*n,t.x-t.r<0&&(t.x=t.r,t.vx*=-1),t.x+t.r>r&&(t.x=r-t.r,t.vx*=-1),t.y-t.r<0&&(t.y=t.r,t.vy*=-1);const s=l.current;if(t.y+t.r>=s.y&&t.y-t.r<=s.y+s.h&&t.x+t.r>=s.x&&t.x-t.r<=s.x+s.w){t.y=s.y-t.r,t.vy*=-1;const m=(t.x-(s.x+s.w/2))/(s.w/2);t.vx+=m*240,_(t),k(t.x,t.y,8)}const y=j.current;for(let m=0;m<y.length;m++){const u=y[m];if(u.alive&&t.x+t.r>=u.x&&t.x-t.r<=u.x+u.w&&t.y+t.r>=u.y&&t.y-t.r<=u.y+u.h){const b=t.x+t.r-u.x,K=u.x+u.w-(t.x-t.r),re=t.y+t.r-u.y,ie=u.y+u.h-(t.y-t.r),V=Math.min(b,K,re,ie);if(V===b||V===K?t.vx*=-1:t.vy*=-1,u.type==="unbreakable"||(u.type==="strong"?(u.hits-=1,u.hits<=0&&(u.alive=!1)):u.alive=!1),u.alive)$(R=>R+40),k(t.x,t.y,8);else if($(R=>R+100),k(t.x,t.y,18),Math.random()<.14){const R=["expand","life","slow","multiball"],oe={x:u.x+u.w/2-12,y:u.y+u.h/2,w:24,h:14,vy:80+Math.random()*60,type:R[Math.floor(Math.random()*R.length)],alive:!0};B.current.push(oe)}break}}t.y-t.r>a&&f.splice(o,1)}if(w.current.length===0)if(E(o=>o-1),I-1<=0)P(!1),T(r,a);else{const o={x:0,y:0,vx:0,vy:0,r:Math.max(6,Math.min(14,r*.008))};C(o,r,a,null),w.current=[o]}d.current.y-d.current.r>a&&(E(o=>o-1),I-1<=0?(P(!1),T(r,a)):C(d.current,r,a,null));const c=B.current;for(let o=c.length-1;o>=0;o--){const t=c[o];if(!t.alive){c.splice(o,1);continue}if(t.y+=t.vy*n,t.y+t.h>=l.current.y&&t.x+t.w>=l.current.x&&t.x<=l.current.x+l.current.w){if(t.type==="expand")l.current.w=Math.min(l.current.w*1.5,500),p.current.expand=performance.now()+8e3;else if(t.type==="life")E(s=>s+1);else if(t.type==="slow")d.current.vx*=.7,d.current.vy*=.7,p.current.slow=performance.now()+7e3;else if(t.type==="multiball"){const s=w.current[0]||{x:l.current.x+l.current.w/2,y:l.current.y-10,vx:-200,vy:-320,r:d.current.r};U(s,2),p.current.multiball=performance.now()+12e3}t.alive=!1,k(t.x+t.w/2,t.y+t.h/2,20)}else t.y>a+40&&c.splice(o,1)}const i=performance.now();if(p.current.expand&&p.current.expand<i){p.current.expand=void 0;const o=e.width/Math.max(1,window.devicePixelRatio||1);l.current.w=Math.max(72,Math.min(220,o*.14))}if(p.current.slow&&p.current.slow<i&&(p.current.slow=void 0,_(d.current)),ee(n),te(n),j.current.every(o=>!o.alive||o.type==="unbreakable")){const o=D+1;G(o),O(r,o),C(d.current,r,a,null),k(r/2,a/2,36)}}function H(){const n=M.current,e=n.getContext("2d"),r=n.width/Math.max(1,window.devicePixelRatio||1),a=n.height/Math.max(1,window.devicePixelRatio||1);e.fillStyle="#08121a",e.fillRect(0,0,r,a);for(const i of j.current)i.alive&&(i.type==="unbreakable"?e.fillStyle="#6b7280":i.type==="strong"?e.fillStyle=i.hits===2?"#f59e0b":"#fb923c":e.fillStyle=`hsl(${i.x%360+i.y%60},70%,60%)`,N(e,i.x,i.y,i.w,i.h,4),e.fill(),e.strokeStyle="rgba(0,0,0,0.18)",e.stroke());const f=l.current;e.fillStyle="#5eead4",N(e,f.x,f.y,f.w,f.h,6),e.fill();for(const i of w.current)e.beginPath(),e.fillStyle="#60a5fa",e.arc(i.x,i.y,i.r,0,Math.PI*2),e.fill();const c=z.current;for(let i=0;i<c.length;i++){const o=c[i],t=Math.max(0,o.life/.45),s=(1-t)*d.current.r*1.6+1;e.beginPath();const y=e.createRadialGradient(o.x,o.y,0,o.x,o.y,s*2);y.addColorStop(0,`rgba(96,165,250,${.5*t})`),y.addColorStop(1,"rgba(96,165,250,0)"),e.fillStyle=y,e.fillRect(o.x-s,o.y-s,s*2,s*2)}for(const i of L.current){const o=Math.max(0,i.life/1.2);e.save(),e.globalCompositeOperation="lighter";const t=Math.max(1,6*o),s=e.createRadialGradient(i.x,i.y,0,i.x,i.y,t*3);s.addColorStop(0,`rgba(255,220,120,${o})`),s.addColorStop(.6,`rgba(255,120,60,${o*.6})`),s.addColorStop(1,"rgba(255,120,60,0)"),e.fillStyle=s,e.fillRect(i.x-t*3,i.y-t*3,t*6,t*6),e.restore()}for(const i of B.current)i.alive&&(e.save(),e.fillStyle=i.type==="expand"?"#34d399":i.type==="life"?"#60a5fa":"#f472b6",N(e,i.x,i.y,i.w,i.h,4),e.fill(),e.fillStyle="#000000",e.font="12px sans-serif",e.fillText(i.type==="expand"?"E":i.type==="life"?"+1":"S",i.x+6,i.y+i.h-4),e.restore());e.fillStyle="#ffffff",e.font="14px sans-serif",e.fillText(`Score: ${Y}`,12,a-12),e.fillText(`Lives: ${I}`,r-84,a-12),e.fillText(`Level: ${D}`,r/2-24,a-12)}function N(n,e,r,a,f,c){n.beginPath(),n.moveTo(e+c,r),n.arcTo(e+a,r,e+a,r+f,c),n.arcTo(e+a,r+f,e,r+f,c),n.arcTo(e,r+f,e,r,c),n.arcTo(e,r,e+a,r,c),n.closePath()}return h.useEffect(()=>{const n=M.current;function e(c){const i=n.getBoundingClientRect(),o=c.clientX-i.left;l.current.x=q(o-l.current.w/2,0,i.width-l.current.w)}function r(c){e(c),S||P(!0)}function a(){}function f(c){const i=n.getBoundingClientRect();c.key==="ArrowLeft"?l.current.x=q(l.current.x-l.current.speed*.03,0,i.width-l.current.w):c.key==="ArrowRight"?l.current.x=q(l.current.x+l.current.speed*.03,0,i.width-l.current.w):c.key===" "&&P(o=>!o)}return n.addEventListener("pointermove",e),n.addEventListener("pointerdown",r),window.addEventListener("pointerup",a),window.addEventListener("keydown",f),()=>{n.removeEventListener("pointermove",e),n.removeEventListener("pointerdown",r),window.removeEventListener("pointerup",a),window.removeEventListener("keydown",f)}},[S]),x.jsxs(X,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column"},children:[x.jsx(ce,{position:"static",color:"transparent",elevation:0,sx:{borderBottom:"1px solid rgba(255,255,255,0.06)"},children:x.jsxs(le,{children:[x.jsx(se,{edge:"start",color:"inherit",onClick:()=>Z("/"),children:x.jsx(ue,{})}),x.jsx(fe,{variant:"h6",sx:{flex:1},children:"Breakout"}),x.jsxs(de,{direction:"row",spacing:1,alignItems:"center",children:[x.jsxs(he,{value:A,size:"small",onChange:n=>Q(n.target.value),children:[x.jsx(F,{value:"Easy",children:"Easy"}),x.jsx(F,{value:"Normal",children:"Normal"}),x.jsx(F,{value:"Hard",children:"Hard"})]}),x.jsx(J,{variant:"outlined",onClick:()=>P(n=>!n),children:S?"Pause":"Play"}),x.jsx(J,{variant:"contained",onClick:()=>{const n=M.current,e=n.width/Math.max(1,window.devicePixelRatio||1),r=n.height/Math.max(1,window.devicePixelRatio||1);T(e,r)},children:"Restart"})]})]})}),x.jsx(pe,{maxWidth:"lg",sx:{py:3,flex:1},children:x.jsx(xe,{sx:{p:2},children:x.jsx(X,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:x.jsx("canvas",{ref:M,style:{touchAction:"none",maxWidth:"100%"}})})})})]})}export{ge as default};
