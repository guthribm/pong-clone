import{r as a,h as de,j as o,B as j}from"./index-B4AHr6Z4.js";import{A as xe,T as pe,I as ge,h as me,j as b,S as ye,M as W,P as ve}from"./ArrowBack-mw4x3yPs.js";import{S as we,B as ne,C as Re}from"./Stack-CGl372gr.js";const y=10,M=20,A={I:[[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]],O:[[[2,2],[2,2]]],T:[[[0,3,0],[3,3,3],[0,0,0]],[[0,3,0],[0,3,3],[0,3,0]],[[0,0,0],[3,3,3],[0,3,0]],[[0,3,0],[3,3,0],[0,3,0]]],L:[[[0,0,4],[4,4,4],[0,0,0]],[[0,4,0],[0,4,0],[0,4,4]],[[0,0,0],[4,4,4],[4,0,0]],[[4,4,0],[0,4,0],[0,4,0]]],J:[[[5,0,0],[5,5,5],[0,0,0]],[[0,5,5],[0,5,0],[0,5,0]],[[0,0,0],[5,5,5],[0,0,5]],[[0,5,0],[0,5,0],[5,5,0]]],S:[[[0,6,6],[6,6,0],[0,0,0]],[[0,6,0],[0,6,6],[0,0,6]]],Z:[[[7,7,0],[0,7,7],[0,0,0]],[[0,0,7],[0,7,7],[0,7,0]]]},q=["#000000","#60a5fa","#f472b6","#a78bfa","#fb923c","#60a5fa","#34d399","#f87171"];function re(){return Array.from({length:M},()=>Array.from({length:y},()=>0))}function je(h){const f=h.length,S=Array.from({length:f},()=>Array.from({length:f},()=>0));for(let d=0;d<f;d++)for(let v=0;v<f;v++)S[v][f-1-d]=h[d][v];return S}function E(){const h=Object.keys(A);for(let f=h.length-1;f>0;f--){const S=Math.floor(Math.random()*(f+1));[h[f],h[S]]=[h[S],h[f]]}return h}function Ce(){const h=a.useRef(null),f=a.useRef(null),S=a.useRef(null),d=a.useRef(null),v=a.useRef(null),[I,J]=a.useState(!1),[se,K]=a.useState(0),[B,U]=a.useState(1),[X,Y]=a.useState(0),[Z,oe]=a.useState("Normal"),L=a.useRef(re()),C=a.useRef(E()),k=a.useRef([]),z=a.useRef(null),D=a.useRef(!0),w=a.useRef(null),O=a.useRef([]),ie=de();function P(){if(k.current.length<3){for(;C.current.length===0;)C.current=E();k.current.push(...C.current.splice(0,3))}const e=k.current.shift(),n=A[e][0].map(r=>r.slice());w.current={shape:n,x:Math.floor((y-n[0].length)/2),y:-n.length+1,id:e},D.current=!0}function ce(){const e=h.current,n=(S.current??e.parentElement).getBoundingClientRect(),r=Math.max(1,window.devicePixelRatio||1),s=Math.floor(Math.min(n.width,n.height));e.style.width=`${s}px`,e.style.height=`${Math.floor(s*(M/y))}px`,e.width=Math.max(1,Math.floor(s*r)),e.height=Math.max(1,Math.floor(s*(M/y)*r)),e.getContext("2d").setTransform(r,0,0,r,0,0),ee()}a.useEffect(()=>{function e(){ce()}return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),a.useEffect(()=>{if(!I){d.current&&cancelAnimationFrame(d.current),d.current=null,v.current=null;return}function e(t){v.current||(v.current=t);const n=Math.min(.05,(t-v.current)/1e3);v.current=t,ae(n),ee(),d.current=requestAnimationFrame(e)}return d.current=requestAnimationFrame(e),()=>{d.current&&cancelAnimationFrame(d.current),d.current=null}},[I]);const H=a.useRef(0);function ae(e){H.current+=e;const t=Math.max(.06,.5-(B-1)*.04-(Z==="Hard"?.12:0));H.current>t&&(H.current=0,V());const n=O.current;for(let r=n.length-1;r>=0;r--)n[r].life-=e,n[r].x+=n[r].vx*e,n[r].y+=n[r].vy*e,n[r].vy+=420*e,n[r].life<=0&&n.splice(r,1)}function Q(){const e=w.current;if(!e)return;const t=L.current;for(let r=0;r<e.shape.length;r++)for(let s=0;s<e.shape[r].length;s++)if(e.shape[r][s]){const i=e.x+s,R=e.y+r;R>=0&&R<M&&i>=0&&i<y&&(t[R][i]=e.shape[r][s])}let n=0;for(let r=M-1;r>=0;r--)t[r].every(s=>s>0)&&(t.splice(r,1),t.unshift(Array.from({length:y},()=>0)),n++,r++);if(n>0){K(r=>r+n*n*100),Y(r=>r+n);for(let r=0;r<n*8;r++)O.current.push({x:Math.random()*y,y:Math.random()*M/2,life:.6+Math.random()*.8,vx:(Math.random()-.5)*80,vy:-100+Math.random()*40});X+n>=B*10&&U(r=>r+1)}P()}function V(){const e=w.current;if(!e){P();return}e.y+=1,T(e)&&(e.y-=1,Q())}function T(e){const t=L.current;for(let n=0;n<e.shape.length;n++)for(let r=0;r<e.shape[n].length;r++){if(!e.shape[n][r])continue;const s=e.x+r,i=e.y+n;if(s<0||s>=y||i>=M||i>=0&&t[i][s]>0)return!0}return!1}function _(e){const t=w.current;t&&(t.x+=e,T(t)&&(t.x-=e))}function le(){const e=w.current;if(!e)return;const t=je(e.shape),n=e.shape;e.shape=t,T(e)&&(e.shape=n)}function fe(){const e=w.current;if(e){for(;!T(e);)e.y+=1;e.y-=1,Q()}}function ue(){if(!D.current)return;const e=w.current;if(!e)return;const t=z.current;z.current=e.id,t?w.current={shape:A[t][0].map(n=>n.slice()),x:Math.floor((y-A[t][0][0].length)/2),y:-A[t][0].length+1,id:t}:P(),D.current=!1}function ee(){const e=h.current,t=e.getContext("2d"),n=e.width/Math.max(1,window.devicePixelRatio||1),r=e.height/Math.max(1,window.devicePixelRatio||1);t.fillStyle="#08121a",t.fillRect(0,0,n,r);const s=n/y,i=r/M,R=L.current;for(let l=0;l<M;l++)for(let c=0;c<y;c++){const x=R[l][c];if(x){const m=c*s,u=l*i,p=t.createLinearGradient(m,u,m+s,u+i);p.addColorStop(0,q[x]),p.addColorStop(1,"#00000000"),t.fillStyle=p,N(t,m+1,u+1,s-2,i-2,4),t.fill()}}const g=w.current;if(g){for(let l=0;l<g.shape.length;l++)for(let c=0;c<g.shape[l].length;c++)if(g.shape[l][c]){const x=(g.x+c)*s,m=(g.y+l)*i,u=g.shape[l][c],p=t.createRadialGradient(x+s/2,m+i/2,2,x+s/2,m+i/2,Math.max(s,i));p.addColorStop(0,q[u]),p.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=p,N(t,x+1,m+1,s-2,i-2,3),t.fill()}}for(const l of O.current){const c=l.x*s,x=l.y*i,m=Math.max(0,l.life/1);t.globalCompositeOperation="lighter";const u=t.createRadialGradient(c,x,0,c,x,10);u.addColorStop(0,`rgba(255,240,200,${m})`),u.addColorStop(1,"rgba(255,140,60,0)"),t.fillStyle=u,t.fillRect(c-12,x-12,24,24),t.globalCompositeOperation="source-over"}he()}function he(){const e=f.current;if(!e)return;const t=Math.max(1,window.devicePixelRatio||1),n=96;e.style.width=`${n}px`,e.style.height=`${n}px`,e.width=n*t,e.height=n*t;const r=e.getContext("2d");r.setTransform(t,0,0,t,0,0),r.clearRect(0,0,n,n);let s=k.current[0];if(s||(C.current.length===0&&(C.current=E()),s=C.current[0]),!s)return;const R=A[s][0],g=R.length,l=R[0].length,c=Math.floor(n/Math.max(l,g)),x=Math.floor((n-l*c)/2),m=Math.floor((n-g*c)/2);for(let u=0;u<g;u++)for(let p=0;p<l;p++){const te=R[u][p];if(!te)continue;const G=x+p*c,$=m+u*c,F=r.createLinearGradient(G,$,G+c,$+c);F.addColorStop(0,q[te]),F.addColorStop(1,"#00000000"),r.fillStyle=F,N(r,G+1,$+1,c-2,c-2,4),r.fill()}}function N(e,t,n,r,s,i){e.beginPath(),e.moveTo(t+i,n),e.arcTo(t+r,n,t+r,n+s,i),e.arcTo(t+r,n+s,t,n+s,i),e.arcTo(t,n+s,t,n,i),e.arcTo(t,n,t+r,n,i),e.closePath()}return a.useEffect(()=>{function e(t){t.key==="ArrowLeft"?_(-1):t.key==="ArrowRight"?_(1):t.key==="ArrowUp"?le():t.key===" "?fe():t.key==="ArrowDown"?V():t.key.toLowerCase()==="c"?ue():t.key==="p"&&J(n=>!n)}return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[]),o.jsxs(j,{sx:{minHeight:"100vh",height:"100vh",display:"flex",flexDirection:"column",overflow:"hidden"},children:[o.jsx(xe,{position:"static",color:"transparent",elevation:0,sx:{borderBottom:"1px solid rgba(255,255,255,0.06)"},children:o.jsxs(pe,{children:[o.jsxs(ge,{edge:"start",color:"inherit",onClick:()=>ie("/"),children:[" ",o.jsx(me,{})," "]}),o.jsx(b,{variant:"h6",sx:{flex:1},children:"Tetris"}),o.jsxs(we,{direction:"row",spacing:1,alignItems:"center",children:[o.jsxs(ye,{value:Z,size:"small",onChange:e=>oe(e.target.value),children:[o.jsx(W,{value:"Easy",children:"Easy"}),o.jsx(W,{value:"Normal",children:"Normal"}),o.jsx(W,{value:"Hard",children:"Hard"})]}),o.jsx(ne,{variant:"outlined",onClick:()=>J(e=>!e),children:I?"Pause":"Play"}),o.jsx(ne,{variant:"contained",onClick:()=>{L.current=re(),C.current=E(),k.current=[],z.current=null,K(0),U(1),Y(0),P()},children:"Restart"})]})]})}),o.jsx(Re,{maxWidth:"lg",sx:{py:2,flex:1,display:"flex",alignItems:"stretch"},children:o.jsxs(ve,{sx:{p:2,width:"100%",height:"100%",display:"flex",flexDirection:"column",boxSizing:"border-box"},children:[o.jsx(j,{ref:S,sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:o.jsx("canvas",{ref:h,style:{touchAction:"none",maxWidth:"100%",height:"100%"}})}),o.jsxs(j,{sx:{mt:1,display:"flex",flexDirection:{xs:"column",sm:"row"},gap:1,justifyContent:"space-between",alignItems:"center",height:{xs:"auto",sm:110}},children:[o.jsxs(j,{sx:{textAlign:{xs:"center",sm:"left"}},children:[o.jsx(b,{variant:"subtitle2",children:"Score"}),o.jsx(b,{variant:"h6",children:se})]}),o.jsxs(j,{sx:{textAlign:{xs:"center",sm:"left"}},children:[o.jsx(b,{variant:"subtitle2",children:"Level"}),o.jsx(b,{variant:"h6",children:B})]}),o.jsxs(j,{sx:{textAlign:{xs:"center",sm:"left"}},children:[o.jsx(b,{variant:"subtitle2",children:"Lines"}),o.jsx(b,{variant:"h6",children:X})]}),o.jsx(j,{sx:{display:"flex",alignItems:"center",justifyContent:{xs:"center",sm:"flex-end"}},children:o.jsxs(j,{sx:{mr:1,width:96,display:"flex",flexDirection:"column",alignItems:"center",bgcolor:"rgba(255,255,255,0.02)",borderRadius:1,p:.5,border:"1px solid rgba(255,255,255,0.06)"},children:[o.jsx(b,{variant:"subtitle2",sx:{fontSize:12},children:"Next"}),o.jsx(j,{sx:{width:96,height:96,display:"flex",alignItems:"center",justifyContent:"center"},children:o.jsx("canvas",{ref:f,style:{width:"100%",height:"100%",display:"block",borderRadius:6}})})]})})]})]})})]})}export{Ce as default};
